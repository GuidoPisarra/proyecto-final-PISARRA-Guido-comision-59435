import{a as $e}from"./chunk-XHYPTXDI.js";import{a as Be,b as je}from"./chunk-IXRLILUS.js";import{a as k,b as Se,d as B,e as Me,f as j,g as ye,h as we,i as Fe,j as Te,k as Oe,l as Re,m as Ae,n as Le,o as Ne,p as Ve,q as ke}from"./chunk-PGJU2VVE.js";import"./chunk-JNFBHA52.js";import{s as de,t as pe}from"./chunk-UM3USEKK.js";import{h as $,i as H,j as Ee,k as Ie,l as q,m as G,n as U}from"./chunk-BUIY3QUJ.js";import{Aa as be,Ba as De,Ca as xe,_ as A,b as ce,m as Z,ma as L,na as ue,oa as Ce,qa as fe,sa as _e,ta as N,va as V,wa as ge,ya as he,za as ve}from"./chunk-W43C5WKI.js";import{Cb as c,Fa as v,Ga as b,Hb as p,Mb as D,Pb as n,Qb as o,Rb as h,Sb as x,Tb as S,Vb as M,Yb as u,_b as C,a as _,b as Q,bd as O,c as ee,ca as Y,cd as R,fa as y,fd as se,gd as me,ic as l,jc as T,ka as te,kb as r,kc as f,la as w,lb as d,mc as ae,nc as oe,oc as ne,pa as ie,rc as le,s as X,tc as re,va as g,wa as F}from"./chunk-YTEZ3TT7.js";function Qe(i,t){i&1&&l(0," Este campo es requerido ")}function Xe(i,t){i&1&&l(0," Este campo es requerido ")}function Ye(i,t){if(i&1&&(n(0,"mat-option",15),l(1),o()),i&2){let e=t.$implicit;p("value",e.value),r(),f(" ",e.label," ")}}function Ze(i,t){i&1&&(n(0,"span"),l(1,"Este campo es requerido"),o())}var P=class i{constructor(t,e,a){this.matDialogRef=t;this.formBuilder=e;this.data=a;this.claseForm=this.formBuilder.group({title:[null,[N.required]],date:[null,[N.required]],duration:[null,[N.required]]}),this.patchFormValue()}claseForm;durationOptions=[{value:"30 min.",label:"30 minutos"},{value:"1 h",label:"1 hora"},{value:"1 h 30 min.",label:"1 hora 30 minutos"},{value:"2 hs",label:"2 horas"},{value:"2 hs 30 min.",label:"2 horas 30 minutos"},{value:"3 hs",label:"3 horas"}];get isEditing(){return!!this.data?.editingClase}patchFormValue(){if(this.data?.editingClase){let t=this.data.editingClase,{date:e}=t,a=ee(t,["date"]);this.claseForm.patchValue(Q(_({},a),{date:this.formatDate(e)}))}}onSave(){this.claseForm.invalid?this.claseForm.markAllAsTouched():this.matDialogRef.close(Q(_({},this.claseForm.value),{id:this.isEditing?this.data.editingClase.id:Be(4),createdAt:this.isEditing?this.data.editingClase.date:new Date}))}formatDate(t){return t?new Date(t).toISOString().split("T")[0]:""}static \u0275fac=function(e){return new(e||i)(d($),d(xe),d(H))};static \u0275cmp=g({type:i,selectors:[["app-clase-dialog"]],decls:32,vars:6,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[1,"row"],[1,"col-12"],[1,"example-form-field","w-100"],["formControlName","title","matInput","","type","text"],[1,"col-6"],["formControlName","date","matInput","","type","date"],["formControlName","duration"],[3,"value",4,"ngFor","ngForOf"],[4,"ngIf"],["mat-dialog-actions",""],["mat-dialog-close","","mat-button",""],["mat-button","",3,"click"],[3,"value"]],template:function(e,a){if(e&1&&(n(0,"h1",0),l(1),o(),n(2,"div",1)(3,"form",2)(4,"div",3)(5,"div",4)(6,"mat-form-field",5)(7,"mat-label"),l(8,"Clase"),o(),h(9,"input",6),n(10,"mat-error"),c(11,Qe,1,0),o()()(),n(12,"div",7)(13,"mat-form-field",5)(14,"mat-label"),l(15,"Fecha"),o(),h(16,"input",8),n(17,"mat-error"),c(18,Xe,1,0),o()()(),n(19,"div",7)(20,"mat-form-field",5)(21,"mat-label"),l(22,"Duraci\xF3n"),o(),n(23,"mat-select",9),c(24,Ye,2,2,"mat-option",10),o(),n(25,"mat-error"),c(26,Ze,2,0,"span",11),o()()()()()(),n(27,"div",12)(28,"button",13),l(29,"Cancelar"),o(),n(30,"button",14),u("click",function(){return a.onSave()}),l(31,"Guardar"),o()()),e&2){let s,m,I;r(),f(" ",a.data!=null&&a.data.editingClase?"Editar":"Crear",` clase
`),r(2),p("formGroup",a.claseForm),r(8),D((s=a.claseForm.get("title"))!=null&&s.hasError("required")?11:-1),r(7),D((m=a.claseForm.get("date"))!=null&&m.hasError("required")?18:-1),r(6),p("ngForOf",a.durationOptions),r(2),p("ngIf",(I=a.claseForm.get("duration"))==null?null:I.hasError("required"))}},dependencies:[O,R,ve,_e,V,ge,be,De,L,B,k,Se,Me,j,A,Ie,q,U,G]})};var W=class i{constructor(t,e){this.dialogRef=t;this.data=e;console.log(e)}onClose(){this.dialogRef.close()}static \u0275fac=function(e){return new(e||i)(d($),d(H))};static \u0275cmp=g({type:i,selectors:[["app-clases-details-modal"]],decls:14,vars:2,consts:[["mat-dialog-title",""],["mat-dialog-content",""],["mat-dialog-actions",""],["mat-button","",3,"click"]],template:function(e,a){e&1&&(n(0,"h2",0),l(1,"Clase"),o(),n(2,"div",1)(3,"p")(4,"strong"),l(5,"Nombre:"),o(),l(6),o(),n(7,"p")(8,"strong"),l(9,"Duraci\xF3n:"),o(),l(10),o()(),n(11,"div",2)(12,"button",3),u("click",function(){return a.onClose()}),l(13,"Cerrar"),o()()),e&2&&(r(6),f(" ",a.data.title,""),r(4),f(" ",a.data.duration,""))},dependencies:[L,q,U,G]})};var z=class i{constructor(t){this._httpClient=t}clases=[];baseURL=de.baseURL;getClases(t){return this._httpClient.get(`${this.baseURL}/clases?courseId=${t}`).pipe(y(e=>this.clases=e))}addClass(t){return this._httpClient.post(`${this.baseURL}/clases`,t).pipe(y(e=>this.clases=[...this.clases,e]))}updateClassById(t,e){return this._httpClient.patch(`${this.baseURL}/clases/${t}`,e).pipe(y(a=>{this.clases=this.clases.map(s=>s.id.toString()===t?_(_({},s),a):s)}),Y(()=>X(this.clases)))}deleteClassById(t,e){return this._httpClient.delete(`${this.baseURL}/clases/${t}?courseId=${e}`).pipe(Y(()=>(this.clases=this.clases.filter(a=>a.id!==t||a.courseId!==e),X(this.clases))))}static \u0275fac=function(e){return new(e||i)(ie(ce))};static \u0275prov=te({token:i,factory:i.\u0275fac,providedIn:"root"})};function tt(i,t){if(i&1&&(n(0,"mat-option",3),l(1),o()),i&2){let e=t.$implicit;p("value",e.id),r(),f(" ",e.course," ")}}function it(i,t){i&1&&(n(0,"th",15),l(1,"Clase"),o())}function at(i,t){if(i&1&&(n(0,"td",16),l(1),o()),i&2){let e=t.$implicit;r(),T(e.title)}}function ot(i,t){i&1&&(n(0,"th",15),l(1,"Fecha"),o())}function nt(i,t){if(i&1&&(n(0,"td",17),l(1),le(2,"date"),o()),i&2){let e=t.$implicit;r(),T(re(2,1,e.date,"dd/MM/yyyy"))}}function lt(i,t){i&1&&(n(0,"th",15),l(1,"Duraci\xF3n"),o())}function rt(i,t){if(i&1&&(n(0,"td",17),l(1),o()),i&2){let e=t.$implicit;r(),T(e.duration)}}function st(i,t){i&1&&(n(0,"th",15),l(1,"Acciones"),o())}function mt(i,t){if(i&1){let e=M();n(0,"button",18),u("click",function(){v(e);let s=C().$implicit,m=C(2);return b(m.openModal(s))}),n(1,"mat-icon"),l(2,"edit"),o()()}}function ct(i,t){if(i&1){let e=M();n(0,"button",18),u("click",function(){v(e);let s=C().$implicit,m=C(2);return b(m.onDelete(s))}),n(1,"mat-icon"),l(2,"delete"),o()()}}function dt(i,t){if(i&1){let e=M();n(0,"td",17)(1,"button",18),u("click",function(){let s=v(e).$implicit,m=C(2);return b(m.viewDetails(s))}),n(2,"mat-icon"),l(3,"visibility"),o()(),c(4,mt,3,0,"button",19)(5,ct,3,0,"button",19),o()}if(i&2){let e=C(2);r(4),p("ngIf",e.isAdmin),r(),p("ngIf",e.isAdmin)}}function pt(i,t){i&1&&h(0,"tr",20)}function ut(i,t){i&1&&h(0,"tr",21)}function Ct(i,t){if(i&1){let e=M();n(0,"button",4),u("click",function(){v(e);let s=C();return b(s.openModal())}),n(1,"mat-icon"),l(2,"add"),o(),l(3," Agregar clase "),o(),n(4,"table",5),x(5,6),c(6,it,2,0,"th",7)(7,at,2,1,"td",8),S(),x(8,9),c(9,ot,2,0,"th",7)(10,nt,3,4,"td",10),S(),x(11,11),c(12,lt,2,0,"th",7)(13,rt,2,1,"td",10),S(),x(14,12),c(15,st,2,0,"th",7)(16,dt,6,2,"td",10),S(),c(17,pt,1,0,"tr",13)(18,ut,1,0,"tr",14),o()}if(i&2){let e=C();r(4),p("dataSource",e.listOfClases),r(13),p("matHeaderRowDef",e.displayedColumns),r(),p("matRowDefColumns",e.displayedColumns)}}var J=class i{constructor(t,e,a,s,m){this._coursesService=t;this._clasesService=e;this._alertService=a;this._authService=s;this.matDialog=m;this._authService.getUserRole().subscribe(I=>{this.isAdmin=I==="admin"})}selectedValue="";listOfCourses=[];listOfClases=[];isLoading=!0;isAdmin=!0;displayedColumns=["title","date","duration","actions"];ngOnInit(){this.loadCourses()}loadCourses(){this.isLoading=!0,this._coursesService.getCourses().subscribe({next:t=>{this.listOfCourses=t},error:()=>{this.isLoading=!1},complete:()=>{this.isLoading=!1}})}onCourseChange(t){let e=t.value;this.selectedValue=e,this.loadClases(e)}loadClases(t){this.isLoading=!0,this._clasesService.getClases(t).subscribe({next:e=>{this.listOfClases=e},error:e=>{console.error("Error al obtener clases:",e),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}onDelete(t){this._alertService.showAlert({title:"\xA1Advertencia!",text:"\xBFEst\xE1s seguro de eliminar esta clase?",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar",customClass:{confirmButton:"swal2-confirm-btn",cancelButton:"swal2-cancel-btn"}}).then(e=>{e.isConfirmed&&(this.isLoading=!0,this._clasesService.deleteClassById(t.id,t.courseId).subscribe({next:a=>{this.listOfClases=a},error:a=>{console.error("Error al eliminar la clase:",a),this.isLoading=!1},complete:()=>{this.isLoading=!1}}))})}openModal(t){this.matDialog.open(P,{data:{editingClase:t}}).afterClosed().subscribe({next:e=>{e&&(t?this.handleUpdate(t.id.toString(),e):this.addClass(e))}})}addClass(t){this.isLoading=!0,t.courseId=this.selectedValue,this._clasesService.addClass(t).subscribe({next:e=>{this.listOfClases=[...this.listOfClases,e]},error:e=>{console.error("Error al agregar la clase:",e),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}handleUpdate(t,e){this.isLoading=!0,this._clasesService.updateClassById(t,e).subscribe({next:a=>{this.listOfClases=a},error:a=>{console.error("Error al actualizar la clase:",a),this.isLoading=!1},complete:()=>{this.isLoading=!1}})}viewDetails(t){let e=this.matDialog.open(W,{width:"500px",data:t})}static \u0275fac=function(e){return new(e||i)(d($e),d(z),d(je),d(pe),d(Ee))};static \u0275cmp=g({type:i,selectors:[["app-clases"]],decls:9,vars:3,consts:[[1,"container"],["name","food",3,"ngModelChange","selectionChange","ngModel"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],["mat-fab","","extended","",1,"btn-crear-clase",3,"click"],["mat-table","",1,"mat-elevation-z10",3,"dataSource"],["matColumnDef","title"],["mat-header-cell","",4,"matHeaderCellDef"],["color","red","app-hightlight","","mat-cell","",4,"matCellDef"],["matColumnDef","date"],["mat-cell","",4,"matCellDef"],["matColumnDef","duration"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["color","red","app-hightlight","","mat-cell",""],["mat-cell",""],["mat-icon-button","",3,"click"],["mat-icon-button","",3,"click",4,"ngIf"],["mat-header-row",""],["mat-row",""]],template:function(e,a){e&1&&(n(0,"div",0)(1,"h4"),l(2,"Seleccione un curso"),o(),n(3,"mat-form-field")(4,"mat-label"),l(5,"Curso"),o(),n(6,"mat-select",1),ne("ngModelChange",function(m){return oe(a.selectedValue,m)||(a.selectedValue=m),m}),u("selectionChange",function(m){return a.onCourseChange(m)}),c(7,tt,2,2,"mat-option",2),o()(),c(8,Ct,19,3),o()),e&2&&(r(6),ae("ngModel",a.selectedValue),r(),p("ngForOf",a.listOfCourses),r(),D(a.selectedValue!=""?8:-1))},dependencies:[O,R,V,Ce,ue,fe,B,k,j,A,ye,Fe,Ae,Te,we,Le,Oe,Re,Ne,Ve,he,se],styles:[".btn-crear-clase[_ngcontent-%COMP%]{margin-bottom:20px;margin-left:20px;background-color:orange;color:#121316}th[_ngcontent-%COMP%]{color:orange}"]})};var ft=[{path:"",component:J}],K=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=F({type:i});static \u0275inj=w({imports:[Z.forChild(ft),Z]})};var Ue=class i{static \u0275fac=function(e){return new(e||i)};static \u0275mod=F({type:i});static \u0275inj=w({imports:[me,ke,K]})};export{Ue as ClasesModule};

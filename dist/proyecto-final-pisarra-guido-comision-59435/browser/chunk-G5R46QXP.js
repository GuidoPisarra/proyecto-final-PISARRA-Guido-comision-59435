import{a as L,b as Mt,c as It,d as Tt,e as Nt}from"./chunk-BGYGAQCJ.js";import{a as bt,b as yt}from"./chunk-IXRLILUS.js";import{a as it,b as nt,d as ot,e as at,g as ct,h as ft,i as St,j as _t,k as gt,l as vt,m as Ct,n as ht,o as Et,p as Dt,q as xt}from"./chunk-PGJU2VVE.js";import"./chunk-JNFBHA52.js";import{t as $}from"./chunk-UM3USEKK.js";import{h as rt,i as lt,j as mt,k as dt,l as st,m as ut,n as pt}from"./chunk-BUIY3QUJ.js";import{Aa as Z,Ba as tt,Ca as et,i as q,k as O,m as B,ma as U,na as z,oa as J,qa as K,sa as Q,ta as k,va as W,wa as X,za as Y}from"./chunk-W43C5WKI.js";import{Cb as m,Fa as x,Ga as b,Hb as d,Mb as v,Pb as o,Qb as a,Rb as p,Sb as C,Tb as h,Vb as M,Yb as f,_b as s,a as j,b as G,cd as I,fd as P,gd as H,ic as r,jc as F,kb as l,kc as g,la as E,lb as u,rc as R,tc as V,va as _,wa as D}from"./chunk-YTEZ3TT7.js";function Rt(t,i){t&1&&(o(0,"small"),r(1,"Este campo es requerido"),a())}function Vt(t,i){if(t&1&&(o(0,"small"),r(1),a()),t&2){let e=s();l(),g(" Este campo requiere al menos de ",e.validationErrors==null||e.validationErrors.minlength==null?null:e.validationErrors.minlength.requiredLength,` letras
`)}}function Bt(t,i){t&1&&(o(0,"small"),r(1,"Este solo admite letras"),a())}function kt(t,i){t&1&&(o(0,"small"),r(1," Por favor, ingrese un email v\xE1lido."),a())}var T=class t{validationErrors=null;static \u0275fac=function(e){return new(e||t)};static \u0275cmp=_({type:t,selectors:[["app-errors-template"]],inputs:{validationErrors:"validationErrors"},decls:4,vars:4,template:function(e,n){e&1&&m(0,Rt,2,0,"small")(1,Vt,2,1,"small")(2,Bt,2,0,"small")(3,kt,2,0,"small"),e&2&&(v(n.validationErrors!=null&&n.validationErrors.required?0:-1),l(),v(n.validationErrors!=null&&n.validationErrors.minlength?1:-1),l(),v(n.validationErrors!=null&&n.validationErrors.pattern&&!(n.validationErrors!=null&&n.validationErrors.email)?2:-1),l(),v(n.validationErrors!=null&&n.validationErrors.email?3:-1))},encapsulation:2})};function Ht(t,i){if(t&1&&p(0,"app-errors-template",15),t&2){let e=s();d("validationErrors",e.firstName==null?null:e.firstName.errors)}}function qt(t,i){if(t&1&&p(0,"app-errors-template",15),t&2){let e=s();d("validationErrors",e.lastName==null?null:e.lastName.errors)}}function Ot(t,i){t&1&&p(0,"app-errors-template")}var y=class t{constructor(i,e,n){this.matDialogRef=i;this.formBuilder=e;this.data=n;this.studentForm=this.formBuilder.group({firstName:[null,[k.required,L]],lastName:[null,[k.required,L]],email:[null,[Mt]]}),this.patchFormValue()}studentForm;get isEditing(){return!!this.data?.editingStudent}patchFormValue(){this.data?.editingStudent&&this.studentForm.patchValue(this.data.editingStudent)}onSave(){this.studentForm.invalid?this.studentForm.markAllAsTouched():this.matDialogRef.close(G(j({},this.studentForm.value),{id:this.isEditing?this.data.editingStudent.id:bt(4),createdAt:this.isEditing?this.data.editingStudent.createdAt:new Date}))}get firstName(){return this.studentForm.get("firstName")}get lastName(){return this.studentForm.get("lastName")}get email(){return this.studentForm.get("email")}static \u0275fac=function(e){return new(e||t)(u(rt),u(et),u(lt))};static \u0275cmp=_({type:t,selectors:[["app-student-dialog"]],decls:31,vars:5,consts:[["mat-dialog-title",""],["mat-dialog-content",""],[3,"formGroup"],[1,"row"],[1,"col-6"],[1,"example-form-field","w-100"],["formControlName","firstName","matInput","","type","text"],[3,"validationErrors",4,"ngIf"],["formControlName","lastName","matInput","","type","text"],[1,"col-12"],["formControlName","email","matInput","","type","email"],[4,"ngIf"],["mat-dialog-actions",""],["mat-dialog-close","","mat-button",""],["mat-button","",3,"click"],[3,"validationErrors"]],template:function(e,n){e&1&&(o(0,"h1",0),r(1),a(),o(2,"div",1)(3,"form",2)(4,"div",3)(5,"div",4)(6,"mat-form-field",5)(7,"mat-label"),r(8,"Nombre"),a(),p(9,"input",6),o(10,"mat-error"),m(11,Ht,1,1,"app-errors-template",7),a()()(),o(12,"div",4)(13,"mat-form-field",5)(14,"mat-label"),r(15,"Apellido"),a(),p(16,"input",8),o(17,"mat-error"),m(18,qt,1,1,"app-errors-template",7),a()()(),o(19,"div",9)(20,"mat-form-field",5)(21,"mat-label"),r(22,"Email"),a(),p(23,"input",10),o(24,"mat-error"),m(25,Ot,1,0,"app-errors-template",11),a()()()()()(),o(26,"div",12)(27,"button",13),r(28,"Cancelar"),a(),o(29,"button",14),f("click",function(){return n.onSave()}),r(30,"Guardar"),a()()),e&2&&(l(),g(" ",n.data!=null&&n.data.editingStudent?"Editando":"Creando",` alumno
`),l(2),d("formGroup",n.studentForm),l(8),d("ngIf",n.firstName==null?null:n.firstName.touched),l(7),d("ngIf",n.lastName==null?null:n.lastName.touched),l(7),d("ngIf",n.email==null?null:n.email.touched))},dependencies:[I,Y,Q,W,X,Z,tt,U,ot,it,nt,at,dt,st,pt,ut,T]})};function $t(t,i){t&1&&(o(0,"th",12),r(1,"Nombre"),a())}function Ut(t,i){if(t&1&&(o(0,"td",13),r(1),R(2,"studentFullName"),a()),t&2){let e=i.$implicit;l(),g("",V(2,1,e,"uppercase")," ")}}function zt(t,i){t&1&&(o(0,"th",12),r(1,"Email"),a())}function Jt(t,i){if(t&1&&(o(0,"td",14),r(1),a()),t&2){let e=i.$implicit;l(),F(e.email)}}function Kt(t,i){t&1&&(o(0,"th",12),r(1,"Creacion"),a())}function Qt(t,i){if(t&1&&(o(0,"td",14),r(1),R(2,"date"),a()),t&2){let e=i.$implicit;l(),F(V(2,1,e.createdAt,"dd/MM/yyyy"))}}function Wt(t,i){t&1&&(o(0,"th",12),r(1,"Acciones"),a())}function Xt(t,i){if(t&1){let e=M();o(0,"button",15),f("click",function(){x(e);let c=s().$implicit,S=s();return b(S.openModal(c))}),o(1,"mat-icon"),r(2,"edit"),a()()}}function Yt(t,i){if(t&1){let e=M();o(0,"button",15),f("click",function(){x(e);let c=s().$implicit,S=s();return b(S.onDelete(c.id))}),o(1,"mat-icon"),r(2,"delete"),a()()}}function Zt(t,i){if(t&1){let e=M();o(0,"td",14)(1,"button",15),f("click",function(){let c=x(e).$implicit,S=s();return b(S.viewDetails(c))}),o(2,"mat-icon"),r(3,"visibility"),a()(),m(4,Xt,3,0,"button",16)(5,Yt,3,0,"button",16),a()}if(t&2){let e=s();l(4),d("ngIf",e.isAdmin),l(),d("ngIf",e.isAdmin)}}function te(t,i){t&1&&p(0,"tr",17)}function ee(t,i){t&1&&p(0,"tr",18)}var w=class t{constructor(i,e,n,c,S,ne){this.matDialog=i;this._studentService=e;this._alertService=n;this._authService=c;this.router=S;this.activatedRoute=ne;this._authService.getUserRole().subscribe(Ft=>{this.isAdmin=Ft==="admin"})}displayedColumns=["name","email","createdAt","actions"];dataSource=[];isLoading=!1;isAdmin=!1;ngOnInit(){this.loadStudents(),this._alertService.subscribeToAlerts()}loadStudents(){this.isLoading=!0,this._studentService.getStudents().subscribe({next:i=>{this.dataSource=i},error:()=>{this.isLoading=!1},complete:()=>{this.isLoading=!1}})}addStudent(i){this.isLoading=!0,i.role="user",this._studentService.addStudent(i).subscribe({next:e=>{this.dataSource=[...this.dataSource,e]},error:()=>{this.isLoading=!1},complete:()=>{this.isLoading=!1}})}onDelete(i){this._alertService.showAlert({title:"\xA1Advertencia!",text:"\xBFEst\xE1s seguro de eliminar este estudiante?",icon:"warning",showCancelButton:!0,confirmButtonText:"S\xED, eliminar",cancelButtonText:"Cancelar",customClass:{confirmButton:"swal2-confirm-btn",cancelButton:"swal2-cancel-btn"}}).then(e=>{e.isConfirmed&&(this.isLoading=!0,this._studentService.deleteStudentById(i).subscribe({next:n=>{this.dataSource=n},error:()=>{this.isLoading=!1},complete:()=>{this.isLoading=!1}}))})}openModal(i){this.matDialog.open(y,{data:{editingStudent:i}}).afterClosed().subscribe({next:e=>{e&&(i?this.handleUpdate(i.id.toString(),e):this.addStudent(e))}})}handleUpdate(i,e){this.isLoading=!0,this._studentService.updateStudentById(i,e).subscribe({next:n=>{this.dataSource=n},error:n=>{this.isLoading=!1},complete:()=>{this.isLoading=!1}})}viewDetails(i){let e=this.matDialog.open(Tt,{width:"500px",data:i})}static \u0275fac=function(e){return new(e||t)(u(mt),u(Nt),u(yt),u($),u(O),u(q))};static \u0275cmp=_({type:t,selectors:[["app-student"]],decls:22,vars:3,consts:[[1,"container"],["mat-fab","","extended","",1,"btn-crear-usuario",3,"click"],["mat-table","",1,"mat-elevation-z10",3,"dataSource"],["matColumnDef","name"],["mat-header-cell","",4,"matHeaderCellDef"],["color","red","app-hightlight","","mat-cell","",4,"matCellDef"],["matColumnDef","email"],["mat-cell","",4,"matCellDef"],["matColumnDef","createdAt"],["matColumnDef","actions"],["mat-header-row","",4,"matHeaderRowDef"],["mat-row","",4,"matRowDef","matRowDefColumns"],["mat-header-cell",""],["color","red","app-hightlight","","mat-cell",""],["mat-cell",""],["mat-icon-button","",3,"click"],["mat-icon-button","",3,"click",4,"ngIf"],["mat-header-row",""],["mat-row",""]],template:function(e,n){e&1&&(o(0,"div",0)(1,"h2"),r(2,"Alumnos"),a(),o(3,"button",1),f("click",function(){return n.openModal()}),o(4,"mat-icon"),r(5,"add"),a(),r(6," Crear alumno "),a(),o(7,"table",2),C(8,3),m(9,$t,2,0,"th",4)(10,Ut,3,4,"td",5),h(),C(11,6),m(12,zt,2,0,"th",4)(13,Jt,2,1,"td",7),h(),C(14,8),m(15,Kt,2,0,"th",4)(16,Qt,3,4,"td",7),h(),C(17,9),m(18,Wt,2,0,"th",4)(19,Zt,6,2,"td",7),h(),m(20,te,1,0,"tr",10)(21,ee,1,0,"tr",11),a()()),e&2&&(l(7),d("dataSource",n.dataSource),l(13),d("matHeaderRowDef",n.displayedColumns),l(),d("matRowDefColumns",n.displayedColumns))},dependencies:[I,J,z,K,ct,St,Ct,_t,ft,ht,gt,vt,Et,Dt,P,It],styles:[".btn-crear-usuario[_ngcontent-%COMP%]{margin-bottom:20px;background-color:orange;color:#121316}th[_ngcontent-%COMP%]{color:orange}"]})};var ie=[{path:"",component:w}],A=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=D({type:t});static \u0275inj=E({imports:[B.forChild(ie),B]})};var At=class t{static \u0275fac=function(e){return new(e||t)};static \u0275mod=D({type:t});static \u0275inj=E({imports:[H,A,xt]})};export{At as StudentsModule};
